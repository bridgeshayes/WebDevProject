<!--
    Authors:    Garrett Hayes, Wes Talley, Johnny Mac Brentlinger, Gavin Davis, Kaylee Miller
	Course:     CSC 3100-001
	Date:       23 February 2024
    Due:        6 March 2024
	File:       index.html
	Purpose:    This single page application is the basis of the Smart Chicken Coop Product by the SwollenHippo Company.
                It contains a login page for returning users along with a registration page for new users receiving their Smart Coop and a dashboard which is currently blank. 
                This application uses CSS and Jquery for apperance and functionality along with incorporating error handling by SweetAlerts2 and input validation by regular expression.
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Coop</title>
    <link href="assets/css/index.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
</head>

<body class="container" style="background-image: url('./assets/images/cartoon-bg.jpg'); background-size: 100%;">
    <!-- This is the Login Card which appears on startup, and has a button for the Registration Card. -->
    <div id="divMain" class="col-12 d-flex justify-content-center align-items-center mt-3 vmin-90 vmax-95">
        <div id="divLogin" class="card col-12 col-md-8 col-lg-5" style="background-color: #a0a9c2">
            <img src="./assets/images/SmartCoop.png" style="width: 50%; margin-left: 135px; padding-top: 10px;">
            <div class="card-body">
                <form>
                    <div>
                        <label for="txtLoginEmail"> Email </label>
                        <input type="email" placeholder="johndoe08@gmail.com" aria-label="Email"
                            class="form__group_oneform__field col-12 mt-2 mb-4" id="txtLoginEmail" />

                        <label for="txtLoginPassword"> Password </label>
                        <input type="password" placeholder="Password (8+ characters)" aria-label="Password"
                            class="form__group_oneform__field col-12 mt-2 mb-4" id="txtLoginPassword" />
                    </div>
                    <button class="comic-button col-6 offset-3 mb-2" id="btnLogin" type="button">
                        Login
                    </button>
                    <button class="col-8 comic-button mt-2 mb-4 btnToggle offset-2" type="button" data-type="login">
                        Need an account?
                    </button>
                </form>
            </div>
        </div>
        <!--This is the Registration Card for new users, and can be accessed by the Login Card. -->
        <div id="divRegister1" class="card col-12 col-md-8 col-lg-5 mt-4 mb-4"
            style="background-color: #a0a9c2; display: none">
            <p class="login-header mt-4">Register</p>
            <div class="card-body ">
                <form id="formRegister">
                    <div class="form-group">
                        <label for="txtFirstName" class="form-label"> First Name </label>
                        <input id="txtFirstName" placeholder="First Name" aria-label="First Name"
                            class="form__group_oneform__field col-12 mb-2" />
                    </div>

                    <div class="form-group">
                        <label for="txtLastName" class="form-label mt-2">
                            Last Name
                        </label>
                        <input id="txtLastName" placeholder="Last Name" aria-label="Last Name"
                            class="form__group_oneform__field col-12 mb-2" />
                    </div>
                    <hr />

                    <div class="form-group">
                        <label for="txtStreetAddress1" class="form-label">
                            Street Address 1
                        </label>
                        <input id="txtStreetAddress1" placeholder="Street Address Line 1"
                            aria-label="Street Address Line One" class="form__group_oneform__field col-12 mb-2" />
                    </div>

                    <!-- This checkbox is used to auto fill / delete the txtStreetAddress2 box based on the contents of txtStreetAddress1 -->
                    <label for="btnFillStAdd"> Street Address 2 not necessary</label>
                    <input type="checkbox" id="btnFillStAdd" class="mt-2 mb-3" />

                    <div class="form-group">
                        <label for="txtStreetAddress2" class="form-label mt-2">
                            Street Address 2 (Optional)</label>
                        <input id="txtStreetAddress2" placeholder="Street Address Line 2"
                            aria-label="Street Address Line Two" class="form__group_oneform__field col-12 mb-2" />
                    </div>
                    <hr />

                    <div class="form-group">
                        <label for="txtCity" class="form-label"> City </label>
                        <input id="txtCity" placeholder="City" aria-label="City"
                            class="form__group_oneform__field col-12 mb-2" />
                    </div>
                    <button class="col-6 offset-3 comic-button mt-2 btnRegisterToggle" id="btnRegisterToggle" type="button" data-type="first">
                        Next Page
                    </button>
                    <button class="col-8 offset-2 comic-button mt-3 mb-4 btnToggle" id="btnReturnToLogin" type="button">
                        Return to Login
                    </button>
                </form>
            </div>
        </div>
        <div id="divRegister2" class="card col-12 col-md-8 col-lg-5 mt-4 mb-4"
        style="background-color: #a0a9c2; display: none">
        <p class="login-header mt-4">Register</p>
        <div class="card-body">
            <form id="formRegister2">
                <div class="form-group">
                    <label for="txtState" class="form-label mt-2"> State </label>
                    <input id="txtState" placeholder="State" aria-label="State"
                        class="form__group_oneform__field col-12 mb-2" />
                </div>

                <div class="form-group">
                    <label for="txtZipCode" class="form-label mt-2"> Zip Code </label>
                    <input id="txtZipCode" placeholder="Zip Code" aria-label="Zip Code"
                        class="form__group_oneform__field col-12 mb-2" />
                </div>
                <hr />

                <div class="form-group">
                    <label for="txtEmail" class="form-label mt-2"> Email </label>
                    <input id="txtEmail" placeholder="johndoe08@gmail.com" aria-label="Email"
                        class="form__group_oneform__field col-12 mb-2" type="email"
                        pattern="/[^0-9a-zA-Z_\-@.\s]/" />
                </div>

                <div class="form-group">
                    <label for="txtPassword" class="form-label mt-2">
                        Password
                    </label>
                    <input id="txtPassword" placeholder="Password (8+ characters)" aria-label="Password"
                        class="form__group_oneform__field col-12 mb-2" type="password"
                        pattern="/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}/" />
                </div>

                <div class="form-group">
                    <label for="txtCoopRegisterID" class="form-label mt-2">
                        Coop Registration ID
                    </label>
                    <input id="txtCoopRegisterID" placeholder="Coop Registration ID"
                        aria-label="Coop Registration ID" class="form__group_oneform__field col-12 mb-2" />
                </div>
                <hr />

                <button class="col-6 offset-3 comic-button mt-2" id="btnRegister" type="button">
                    Register
                </button>
                <button class="col-8 offset-2 comic-button mt-3 mb-4 btnRegisterToggle" id="btnRegisterToggle" type="button">
                    Previous Page
                </button>
            </form>
        </div>
    </div>
        <!-- This is the Dashboard Card, -->
        <div id="divDashboard" class="card col-12 mt-3 mb-3" style="background-color: #a0a9c2; display: none;">
            <!-- add display:none; when finished. -->
            <div class="login-header mt-4 col-12">
                <div class="col-11 d-flex" id="divDashBoardHeader">
                    <div class="col-4 row">
                        <div class="col-2 offset-1">
                            <img src="assets/icons/icons8-account-48.png" class="" />
                        </div>
                        <div class="col-8 justify-content-left d-flex">
                            <h5 class="mt-4" id="txtUserAccount"></h5>
                        </div>
                    </div>
                    <div class="col-4 justify-content-center d-flex">
                        <img src="./assets/images/SmartCoop.png" style="width: 80%; margin-left: 130px;">
                    </div>
                    <div class="col-4 justify-content-end d-flex">
                        <button class="comic-button mt-3 mb-1" id="btnSettings" type="button">
                            Settings
                        </button>
                        <button class="comic-button mt-3 mb-1 ms-3 btnLogout" id="btnLogout" type="button">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
            <hr />
            <div class="card-body col-12 row">
                <div class="col-6 d-flex justify-content-center">
                    <div class="card col-10">
                        <div class="card-body" id="divAddEggs">
                            <img src="assets/icons/icons8-eggs-50.png" />
                            <h2>Eggs</h2>

                            <div class="form-group">
                                <label for="txtEggCounter" class="form-label mt-3">
                                    Number of Eggs Harvested
                                </label>
                                <input id="txtEggCounter" placeholder="Number of Eggs Harvested"
                                    aria-label="Number of Eggs Harvested"
                                    class="form__group_oneform__field col-12 mb-2" />

                                <label for="txtEggCollectionDate" class="form-label mt-3">
                                    Collection Date
                                </label>
                                <input id="txtEggCollectionDate" placeholder="Observation Date"
                                    aria-label="Observation Date" type="datetime-local"
                                    class="form__group_oneform__field col-12 mb-3" />
                                <hr />
                                <button class="col-10 offset-1 comic-button mt-3" id="btnEggCounter" type="button">
                                    Enter Eggs Harvested
                                </button>
                                <button class="col-10 offset-1 comic-button mt-3 mb-4" id="btnShowEggs" type="button">
                                    Show Total Egg Count
                                </button>
                            </div>
                        </div>
                        <div class="card-body" id="divViewEggs" style="display: none">
                            <img src="assets/icons/icons8-eggs-50.png" />
                            <h2>Eggs</h2>
                            <div id="calendar"></div>
                            <button class="col-10 offset-1 comic-button mt-3" id="btnReturnToAddEggs" type="button">
                                Return
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-6 d-flex justify-content-center">
                    <div class="card col-10" id="divEnvironment">
                        <div class="card-body" id="divAddWeather">
                            <img src="assets/icons/icons8-cloud-50.png" />
                            <h2>Environment</h2>
                            <div class="form-group">
                                <label for="txtTemperature" class="form-label mt-3">
                                    Observed Temperature
                                </label>
                                <input id="txtTemperature" placeholder="Observed Temperature"
                                    aria-label="Observed Temperature" class="form__group_oneform__field col-12 mb-2" />

                                <label for="txtHumidity" class="form-label mt-3">
                                    Observed Humidity
                                </label>
                                <input id="txtHumidity" placeholder="Observed Humidity" aria-label="Observed Humidity"
                                    class="form__group_oneform__field col-12 mb-2" />

                                <label for="txtObservationDate" class="form-label mt-3">
                                    Observation Date
                                </label>
                                <input id="txtObservationDate" placeholder="Observation Date"
                                    aria-label="Observation Date" type="date"
                                    class="form__group_oneform__field col-12 mb-3" />
                                <hr>
                                <button class="col-10 offset-1 comic-button mt-3" id="btnRecordWeather" type="button">
                                    Record Weather Data
                                </button>
                                <button class="col-10 offset-1 comic-button mt-3 mb-4" id="btnShowWeather"
                                    type="button">
                                    Show All Weather Data
                                </button>
                            </div>
                        </div>
                        <div class="card-body" id="divViewWeather" style="display: none">
                            <img src="assets/icons/icons8-cloud-50.png" />
                            <h2>Environment</h2>
                            <canvas id="myChart"></canvas>
                            <hr>
                            <button class="col-10 offset-1 comic-button mt-3" id="btnReturnToAddWeather" type="button">
                                Return
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="divSettings" class="col-12 mt-3 mb-3" style="background-color :#a0a9c2; display: none;">
            <div class="card-body">
                <p class="login-header mt-4"> Settings</p>
                <div class="d-flex justify-content-center">
                    <button class="comic-button mt-3 mb-1" id="btnReturnToDashboard" type="button">Dashboard</button>
                    <button class="comic-button mt-3 mb-1 ms-3 btnLogout" id="btnSettingsLogout" type="button">Logout</button>
                </div>
                <hr>
            </div>
            <div class="card-body col-12 row mb-3">
                <div class="col-6 d-flex justify-content-center">
                    <div class="card col-10">
                        <div class="card-body" id="divCoopSettings">
                            <h2>Coop Settings</h2>

                            <div class="form-group">
                                <label for="txtCurrentTemp" class="form-label mt-3">
                                    Set Temperature
                                </label>
                                <input id="txtCurrentTemp" placeholder="Current Temperature"
                                    aria-label="Current Temperature" class="form__group_oneform__field col-12 mb-2" />

                                <div class="form-group row">
                                    <label for="txtCurrentLightStatus" class="form-label mt-3">
                                    Set Light Status
                                    </label>
                                    <button class="col-5 comic-button ms-3 mt-3 mb-4" id="btnLightStatusOn"type="button">Turn Light On</button>
                                    <button class="col-5 offset-1 comic-button mt-3 mb-4" id="btnLightStatusOff"type="button">Turn Light Off</button>
                                </div>

                                <div class="form-group row">
                                    <label for="txtCurrentDoorStatus" class="form-label mt-3">
                                    Set Light Status
                                    </label>
                                    <button class="col-5 comic-button ms-3 mt-3 mb-4" id="btnDoorStatusOpen"type="button">Open Door</button>
                                    <button class="col-5 offset-1 comic-button mt-3 mb-4" id="btnDoorStatusClosed"type="button">Close Door</button>
                                </div>

                                <hr />
                                <button class="col-10 offset-1 comic-button mt-3 mb-4" id="btnUpdateCoopSettings"
                                    type="button">
                                    Update Coop Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 d-flex justify-content-center">
                    <div class="card col-10" id="divUserSettings mb-3">
                        <div class="card-body scroll">
                            <h2>User Settings</h2>
                            <div class="form-group">
                                <div class="form-group">
                                    <label for="txtSettingsFirstName" class="form-label mt-3"> First Name </label>
                                    <input id="txtSettingsFirstName" placeholder="First Name" aria-label="First Name"
                                        class="form__group_oneform__field col-12 mb-2" />
                                </div>

                                <div class="form-group">
                                    <label for="txtSettingsLastName" class="form-label mt-2">
                                        Last Name
                                    </label>
                                    <input id="txtSettingsLastName" placeholder="Last Name" aria-label="Last Name"
                                        class="form__group_oneform__field col-12 mb-2" />
                                </div>
                                <hr />

                                <div class="form-group">
                                    <label for="txtSettingsStreetAddress1" class="form-label">
                                        Street Address 1
                                    </label>
                                    <input id="txtSettingsStreetAddress1" placeholder="Street Address Line 1"
                                        aria-label="Street Address Line One"
                                        class="form__group_oneform__field col-12 mb-2" />
                                </div>

                                <div class="form-group">
                                    <label for="txtSettingsStreetAddress2" class="form-label mt-2">
                                        Street Address 2 (Optional)</label>
                                    <input id="txtSettingsStreetAddress2" placeholder="Street Address Line 2"
                                        aria-label="Street Address Line Two"
                                        class="form__group_oneform__field col-12 mb-2" />
                                </div>
                                <hr />

                                <div class="form-group">
                                    <label for="txtSettingsCity" class="form-label"> City </label>
                                    <input id="txtSettingsCity" placeholder="City" aria-label="City"
                                        class="form__group_oneform__field col-12 mb-2" />
                                </div>

                                <div class="form-group">
                                    <label for="txtSettingsState" class="form-label mt-2"> State </label>
                                    <input id="txtSettingsState" placeholder="State" aria-label="State"
                                        class="form__group_oneform__field col-12 mb-2" />
                                </div>

                                <div class="form-group">
                                    <label for="txtSettingsZipCode" class="form-label mt-2"> Zip Code </label>
                                    <input id="txtSettingsZipCode" placeholder="Zip Code" aria-label="Zip Code"
                                        class="form__group_oneform__field col-12 mb-2" />
                                </div>
                                <hr />

                                <div class="form-group">
                                    <label for="txtSettingsEmail" class="form-label mt-2"> Email </label>
                                    <input id="txtSettingsEmail" placeholder="Email" aria-label="Email"
                                        class="form__group_oneform__field col-12 mb-2" type="email"
                                        pattern="/[^0-9a-zA-Z_\-@.\s]/" />
                                </div>

                                <div class="form-group">
                                    <label for="txtSettingsPassword" class="form-label mt-2">
                                        Password
                                    </label>
                                    <input id="txtSettingsPassword" placeholder="Password (8+ characters)"
                                        aria-label="Password" class="form__group_oneform__field col-12 mb-2"
                                        type="text" pattern="/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}/" />
                                </div>

                                <div class="form-group">
                                    <label for="txtSettingsCoopRegisterID" class="form-label mt-2">
                                        Coop Registration ID
                                    </label>
                                    <input id="txtSettingsCoopRegisterID" placeholder="Coop Registration ID"
                                        aria-label="Coop Registration ID"
                                        class="form__group_oneform__field col-12 mb-2" />
                                </div>
                                <hr />
                                <button class="col-10 offset-1 comic-button mt-3" id="btnUpdateProfileSettings"
                                    type="button">Update Profile Settings</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('myChart').getContext('2d');
        ctx.canvas.height = 250;


        // function getRandomTemperature() {
        //     // Generate a random temperature between 42 and 90
        //     return Math.random() * (90 - 42) + 42;
        // }
        // function getRandomHumidity() {
        //     // Generate a random humidity between 30 and 98
        //     return Math.random() * (98 - 30) + 30;
        // }
        //     // Loop to execute the code block 100 times
        // for (var i = 0; i < 6; i++) {
        //     // The SessionID and additional data with random temperature, humidity,     
        //     //and observationdatetime
        //     var requestData = {
        //         SessionID: sessionStorage.getItem('SessionID'),
        //         temperature: getRandomTemperature(),
        //         observationDateTime: `2024-4-${i+9}`,
        //         humidity: getRandomHumidity()
        //     };
        //     // Making the AJAX request using POST
        //     $.post('https://simplecoop.swollenhippo.com/environment.php', requestData,  function(result) {
        //         console.log(result);
        //     });
        // }



        var lastWeeksDays = getLastWeeksDays(new Date().getTime())

        function getLastWeeksDays(lastDay) {
            let funMath = 24 * 60 * 60 * 1000;
            let arrWeek = [];
            for (let i = 6; i >= 0; i--) {
                arrWeek.push(moment(lastDay - i * funMath).format("YYYY-MM-DD"));
            }
            return arrWeek;
        }



        // These regular expressions are used to validate the user's email and password.
        var regexEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        var regexPassword = /(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}/;
        var CoopID = "QEJ73JMH"
        // runs on app launch if they have an active session id then fetches the session details

        $(document).ready(() => {
            if (sessionStorage.getItem("SessionID")) {
                $.ajax({
                    url:
                        "https://simplecoop.swollenhippo.com/sessions.php?SessionID=" +
                        sessionStorage.getItem("SessionID"),
                    type: "GET",
                    success: (result) => {
                        result = $.parseJSON(result);
                        //saves all the varaibles that the session details provide.
                        //console.log(result)
                        let dateString = result.LastUsedDateTime;
                        let emailTest = result.Email;
                        $("#txtUserAccount").text(emailTest);
                        let dateObj = new Date(dateString);
                        let day = dateObj.getDate(); // returns the day to see if the user hasn't logged on in over a day.
                        let currDate = new Date();
                        let currDay = currDate.getDate();

                        if ((currDay - day) > 0) { // aka the user's last sign-on was the day before.
                            Swal.fire({
                                icon: "error",
                                title: "Session expired",
                                text: "Please log in again.",
                            });
                            sessionStorage.removeItem("SessionID")
                            $('#divDashboard').slideToggle("slow", () => {
                                $('#divLogin').slideToggle("slow")
                            })
                        }
                        else { //sends a put to the sessions which lets us update the date of use
                            $.ajax({
                                url: "https://simplecoop.swollenhippo.com/sessions.php",
                                type: "PUT",
                                contentType: "application/json",
                                data: {
                                    SessionID: sessionStorage.getItem("SessionID"),
                                },
                                success: (result) => {
                                    console.log(result);
                                },
                                error: (result) => {
                                    console.log(result);
                                },
                            });
                            $("#divLogin").slideUp("fast", () => {
                                $("#divDashboard").slideDown("fast");
                            });
                        }
                    },
                    error: (result) => {
                        console.log(result);
                    },
                });

                $.ajax({
                    url: 'https://simplecoop.swollenhippo.com/environment.php',
                    type: 'GET',
                    data: {
                        SessionID: sessionStorage.getItem('SessionID'),
                        days: lastWeeksDays.join(',')
                    },
                    success: (result) => {
                        if (result) {
                            if (typeof result === 'string') {
                                result = JSON.parse(result)
                            }
                            // making a smaller array consisting of only the temps for each day, making it parallel with humidities.
                            let temps = []
                            let hums = []
                            // this section of code below populats the chart with ONLY relevant environment data.
                            let i = 0
                            // trims the front of the returned array
                            while (result[i].ObservationDateTime != (lastWeeksDays[0] + ' 00:00:00')) {
                                i++
                            }
                            result.splice(0, i) // gets rid of the first 'i' elements (holy crap, this actually worked!)
                            // trims the back of the array
                            if (result.length > 7) { // so even AFTER we trim the front, we might need to trim the back too
                                while (result[result.length - 1].ObservationDateTime > (lastWeeksDays[6] + ' 00:00:00')) {
                                    result.pop()
                                }
                            }
                            // this filter keeps only one occurrence of a day's data.
                            result = result.filter((obj, index, self) =>
                                index === self.findIndex((t) => (
                                    t.ObservationDateTime === obj.ObservationDateTime
                                ))
                            );
                            // this loop only adds relevant environment data to the chart
                            for (let j = 0; j < 7; j++, i++) {
                                if (result[j].ObservationDateTime == (lastWeeksDays[j] + ' 00:00:00')) {
                                    temps.push(result[j].Temperature)
                                    hums.push(result[j].Humidity)
                                }
                            }
                            ///////////////////////////
                            var envChart = new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: lastWeeksDays,
                                    datasets: [
                                        {
                                            label: 'Temperature',
                                            data: temps,
                                            borderWidth: 1,
                                            yAxisID: 't',
                                            tension: 0.25,
                                        },
                                        {
                                            label: 'Humidity',
                                            data: hums,
                                            borderWidth: 1,
                                            yAxisID: 'h',
                                            tension: 0.25,
                                        }
                                    ]
                                },
                                options: {
                                    scales: {
                                        t: {
                                            type: 'linear',
                                            display: true,
                                            position: 'left',
                                        },
                                        h: {
                                            type: 'linear',
                                            display: true,
                                            position: 'right',
                                            grid: {
                                                drawOnChartArea: false, // only want the grid lines for one axis to show up
                                            },
                                        }
                                    }
                                }
                            });
                        }
                    },
                    error: (result) => {
                        console.log(result)
                    }
                })
            }
        });
        //button that triggers when the egg counter is clicked
        $("#btnEggCounter").on("click", () => {
            let strSessionID = sessionStorage.getItem("SessionID");
            let strDate = $("#txtEggCollectionDate").val();
            let strEggs = $("#txtEggCounter").val();
            let objDate = new Date(strDate);
            let strTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            strDate.toLocaleString('en-US', { timeZone: strTimeZone })
            //if we click the egg button then we  make sure that all the variables have data, then we make a post to update the counter 
            if (strEggs && strSessionID && strDate) {
                $.ajax({
                    url: `https://simplecoop.swollenhippo.com/eggs.php`,
                    type: "POST",
                    data: {
                        SessionID: strSessionID,
                        observationDateTime: strDate,
                        eggs: strEggs
                    },
                    success: (result) => { //if the post was successful we tell the user we recored another egg and set the egg counter to 0
                        console.log(result);
                        sessionStorage.setItem("LogID", result.LogID);
                        Swal.fire({
                            icon: "success",
                            title: "Egg count recorded!",
                        });
                        $("#txtEggCollectionDate").val("");
                        $("#txtEggCounter").val("");
                    },
                    error: (result) => {
                        console.log(result);
                    }
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "Inputs cannot be blank",
                });
            }
        });

        $("#btnReturnToAddEggs").on("click", () => { //btn to switch from viewing eggs to adding them
            $("#divViewEggs").slideToggle(() => {
                $("#divAddEggs").slideToggle();
            });
        });

        $("#btnShowEggs").on("click", () => { //btn to show the eggs
            $("#divAddEggs").slideToggle(() => {
                $("#divViewEggs").slideToggle(() => {
                    var calendarEl = document.getElementById("calendar");  //sets the calendar element to the result of the get (I think this is what is happening)
                    var calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: "dayGridMonth",
                        dateClick: (info) => {
                            let arrEggsForDay = [];
                            $.ajax({
                                url: `https://simplecoop.swollenhippo.com/eggs.php?SessionID=${sessionStorage.getItem(
                                    "SessionID"
                                )}&days=${info.dateStr}`,
                                type: "GET",
                                success: function (result) {
                                    result = JSON.parse(result);
                                    result.forEach(element => {
                                        if (element.LogDateTime.substring(0, 10) == info.dateStr.substring(0, 10)) {
                                            arrEggsForDay.push(element);
                                        }
                                    });

                                    let strHtml = ""
                                    arrEggsForDay.forEach(element => {
                                        strHtml = strHtml + "<p>" + element.LogDateTime.substring(11, 16) + "- " + element.Harvested + "</p>";
                                    });
                                    Swal.fire({
                                        title: 'Eggs',
                                        html: '<h1>' + info.dateStr.substring(0, 10) + '</h1>' + '<h3>Date   Eggs</h3>' + strHtml,
                                        icon: 'info'
                                    });
                                },
                                error: function (result) {
                                    console.log("boo" + result);
                                },
                            });
                        },
                    });
                    calendar.render();
                });
            });
        });

        $("#btnShowWeather").on("click", () => { //btn to go from the add weather to viewing it
            $("#divAddWeather").slideToggle(() => {
                $("#divViewWeather").slideToggle()
            })

        })

        $('#btnReturnToAddWeather').on("click", () => { //btn to go from viewing weather to adding
            $("#divViewWeather").slideToggle(() => {
                $("#divAddWeather").slideToggle();
            });
        });

        $("#btnSettings").on("click", () => {
            $("#divDashboard").slideToggle(() => {
                $("#divSettings").slideToggle()
            })
            if (sessionStorage.getItem("SessionID")) {
                $.ajax({
                    url:
                        "https://simplecoop.swollenhippo.com/sessions.php?SessionID=" +
                        sessionStorage.getItem("SessionID"),
                    type: "GET",
                    success: (result) => {
                        result = $.parseJSON(result);
                        userEmail = result.Email
                    $.ajax({
                        url: "https://simplecoop.swollenhippo.com/users.php?Email=" +
                        userEmail,
                        type: 'GET',
                        success: function (user) {
                            user = $.parseJSON(user);
                            $('#txtSettingsEmail').val(user.Email);
                            $('#txtSettingsPassword').val(user.Password);
                            $('#txtSettingsFirstName').val(user.FirstName);
                            $('#txtSettingsLastName').val(user.LastName);
                            $('#txtSettingsCoopRegisterID').val(user.Coop);
                        },
                        error: function (result) {
                            console.log(result)
                        }
                    })
                    
                    $.ajax({
                        url: "https://simplecoop.swollenhippo.com/useraddress.php?Email=" +
                        userEmail,
                        type: 'GET',
                        success: function (address) {
                            address = $.parseJSON(address);
                            console.log(address)
                            $('#txtSettingsStreetAddress1').val(address.Street1);
                            $('#txtSettingsStreetAddress2').val(address.Street2);
                            $('#txtSettingsCity').val(address.City);
                            $('#txtSettingsState').val(address.State);
                            $('#txtSettingsZipCode').val(address.ZIP);
                            $('#txtSettingsEmail').val(address.Email);
                        },
                        error: (result) => {
                            console.log(result);
                        },
                    });
                    $.ajax({
                        url: "https://simplecoop.swollenhippo.com/settings.php?SessionID=" +
                        sessionStorage.getItem("SessionID"),
                        type: 'GET',
                        success: function (address) {
                            address = $.parseJSON(address);
                            console.log(address)
                            $("#txtCurrentTemp").val(address.CurrentTemp);
                            $("#txtCurrentLightStatus").val(address.CurrentLightStatus);
                            $("#txtCurrentDoorStatus").val(address.CurrentDoorStatus);
                        },
                        error: (result) => {
                            console.log(result);
                        },
                    });
                
                    },
                });
            }
        });

        $("#btnUpdateProfileSettings").on("click", () => {
            let btnError = "";
            let strFirstName = $('#txtSettingsFirstName').val();
            let strLastName = $('#txtSettingsLastName').val();
            let strStreetAddress1 = $('#txtSettingsStreetAddress1').val();
            let strStreetAddress2 = $('#txtSettingsStreetAddress2').val();
            let strCity = $('#txtSettingsCity').val();
            let strState = $('#txtSettingsState').val();
            let strZipCode = $('#txtSettingsZipCode').val();
            let strEmail = $('#txtSettingsEmail').val();
            let strPassword = $('#txtSettingsPassword').val();
            let strCoopID = $('#txtSettingsCoopRegisterID').val();
            if (strFirstName.length < 1) { //all validation
                btnError += "<p>Invalid First Name (cannot be blank)</p>";
            }
            if (strLastName.length < 1) {
                btnError += "<p>Invalid Last Name (cannot be blank)</p>";
            }
            if (strStreetAddress1.length < 2) {
                btnError += "<p>Invalid Address (must be at least 2 characters)</p>";
            }
            if (strCity.length < 2) {
                btnError += "<p>Invalid City (must be at least 2 characters)</p>";
            }
            if (strState.length < 2) {
                btnError += "<p>Invalid State (must be at least 2 characters)</p>";
            }
            if (strZipCode.length != 5) {
                btnError += "<p>Invalid Zip Code (must be 5 characters)</p>";
            }
            if (!regexEmail.test(strEmail)) {
                btnError +=
                    '<p>Invalid Email (must have a "@", ".", and be a valid length)</p>';
            }
            if (!regexPassword.test(strPassword)) {
                btnError +=
                    "<p>Invalid Password (Must have 8+ characters with 1 digit, 1 upper case and 1 lower case character)</p>";
            }
            if (btnCoopID != "QEJ73JMH") {
                btnError += "<p>Invalid Coop ID (Must be 8 digits)</p>";
            }

            if (btnError) {
                Swal.fire({
                    title: "Oops!",
                    html: btnError,
                    icon: "error",
                });
            } else {
                $.ajax({
                    url: "https://simplecoop.swollenhippo.com/users.php",
                    type: "PUT",
                    data: {
                        SessionID: sessionStorage.getItem("SessionID"),
                        FirstName: strFirstName,
                        LastName: strLastName,
                        Email: strEmail,
                        Password: strPassword,
                        Coop: strCoopID,
                    },
                    success: function (result) {
                        console.log(result);
                        Swal.fire({
                            icon: "success",
                            title: "Profile Updated!",
                        });
                    },
                    error: function (result) {
                        console.log(result);
                    },
                });
                $.ajax({
                    url: "https://simplecoop.swollenhippo.com/useraddress.php",
                    type: "PUT",
                    data: {

                    },
                    success: function (result) {
                        console.log(result);
                        Swal.fire({
                            icon: "success",
                            title: "Address Updated!",
                        });
                    },
                    error: function (result) {
                        console.log(result);
                    },
                });
            }
        });

        $("#btnUpdateCoopSettings").on("click", () => {
            let btnError = "";
            let strCurrentTemp = $('#txtCurrentTemp').val();
            let strCurrentLightStatus = $('#txtCurrentLightStatus').val();
            let strCurrentDoorStatus = $('#txtCurrentDoorStatus').val();
            
            if (strCurrentTemp.length < 1) {
                btnError += "<p>Invalid Temperature (cannot be blank)</p>";
            }
            if (strCurrentLightStatus.length < 1) {
                btnError += "<p>Invalid Light Status (cannot be blank)</p>";
            }
            if (strCurrentDoorStatus.length < 1) {
                btnError += "<p>Invalid Door Status (cannot be blank)</p>";
            }

            if (btnError) {
                Swal.fire({
                    title: "Oops!",
                    html: btnError,
                    icon: "error",
                });
            } else {
                $.ajax({
                    // url: "https://simplecoop.swollenhippo.com/settings.php?SessionID=" +
                    //     sessionStorage.getItem("SessionID"),
                    url: "https://simplecoop.swollenhippo.com/settings.php",
                    type: "POST",
                    data: {
                        SessionID: sessionStorage.getItem("SessionID"),
                        CurrentTemp: strCurrentTemp,
                        CurrentLightStatus: strCurrentLightStatus,
                        CurrentDoorStatus: strCurrentDoorStatus,
                    },
                    success: function (result) {
                        console.log(result);
                        Swal.fire({
                            icon: "success",
                            title: "Settings Updated!",
                        });
                    },
                    error: function (result) {
                        console.log(result);
                    },
                });
                // $.ajax({
                //     url: "https://simplecoop.swollenhippo.com/useraddress.php",
                //     type: "PUT",
                //     data: {


                //     },
                //     success: function (result) {
                //         console.log(result);
                //         Swal.fire({
                //             icon: "success",
                //             title: "Address Updated!",
                //         });
                //     },
                //     error: function (result) {
                //         console.log(result);
                //     },
                // });
            }
        });

        $("#btnReturnToDashboard").on("click", () => {
            $("#divSettings").slideToggle(() => {
                $("#divDashboard").slideToggle()
            })
        })

        $("#btnLogout").on("click", function () { //logout button which sends a delete to end the session and returns to login from the dashboard card.
            $.ajax({
                url:
                    "https://simplecoop.swollenhippo.com/sessions.php?SessionID=" +
                    sessionStorage.getItem("SessionID"),
                type: "DELETE",
                success: function (result) {
                    sessionStorage.removeItem("SessionID");
                    $("#divDashboard").slideUp(function () {
                        $("#divLogin").slideDown();
                    });
                },
            });
            Swal.fire({
                title: "Success",
                icon: "success",
                text: "Logout successful!",
            });
        });

        $("#btnSettingsLogout").on("click", function () { //logout button which sends a delete to end the session and returns to login from the settings card.
            $.ajax({
                url:
                    "https://simplecoop.swollenhippo.com/sessions.php?SessionID=" +
                    sessionStorage.getItem("SessionID"),
                type: "DELETE",
                success: function (result) {
                    sessionStorage.removeItem("SessionID");
                    $("#divSettings").slideUp(function () {
                        $("#divLogin").slideDown();
                    });
                },
            });
            Swal.fire({
                title: "Success",
                icon: "success",
                text: "Logout successful!",
            });
        });

        $('#btnRecordWeather').on('click', () => { //when the record weather button is hit we collect all the variables we took as input and make a post
            let strTemp = $('#txtTemperature').val();
            let strHumid = $('#txtHumidity').val();
            let strObvDate = $('#txtObservationDate').val();

            if (strTemp && strHumid && strObvDate) { // post sends the variables to record the weather 
                $.ajax({
                    url: `https://simplecoop.swollenhippo.com/environment.php`,
                    type: 'POST',
                    data: {
                        SessionID: sessionStorage.getItem('SessionID'),
                        observationDateTime: strObvDate,
                        temperature: strTemp,
                        humidity: strHumid
                    },
                    success: (result) => {
                        console.log(result)
                        Swal.fire({
                            icon: 'success',
                            title: 'Refresh to update chart!'
                        })
                    },
                    error: (result) => {
                        console.log(result)
                    }
                })
            } else {
                Swal.fire({
                    icon: "error",
                    title: "Inputs cannot be blank",
                });
            }
        })

        // This is the function that adds / clears out txtStreetAddress2 based on the contents of txtStreetAddress1
        $("#btnFillStAdd").on("click", function () {
            if (
                $("#txtStreetAddress1").val() &&
                $("#txtStreetAddress2").val() == ""
            ) {
                $("#txtStreetAddress2").val($("#txtStreetAddress1").val());
            } else {
                $("#txtStreetAddress2").val("");
            }
        });

        // This is the function that toggles the Login and Registration Pages.
        $(".btnToggle").on("click", function () {
            let page = $(this).attr("data-type");

            if (page == "login") {
                $("#divLogin").slideToggle(function () {
                    $("#divMain").removeClass("vh-100");
                    $("#divRegister1").slideToggle("slow");
                });
            } else {
                // clears the registration form if we return to login.
                $("#txtFirstName").val("");
                $("#txtLastName").val("");
                $("#txtStreetAddress1").val("");
                $("#txtStreetAddress2").val("");
                $("#txtCity").val("");
                $("#txtState").val("");
                $("#txtZipCode").val("");
                $("#txtEmail").val("");
                $("#txtPassword").val("");
                $("#txtCoopRegisterID").val("");

                $("#divRegister1").slideToggle(function () {
                    $("#divMain").addClass("vh-100");
                    $("#divLogin").slideToggle("slow");
                });
            }
        });
 //button for the registration page toggle
        $(".btnRegisterToggle").on("click", function () {
            let page = $(this).attr("data-type");

            if (page == "first") {
                $("#divRegister1").slideToggle(function () {
                    $("#divRegister2").slideToggle("slow");
                });
            } else {
                $("#divRegister2").slideToggle(function () {
                    $("#divRegister1").slideToggle("slow");
                });
            }
        });


        // This is the function that validates the email and password by the use of regular expressions on the Login Card.
        $("#btnLogin").on("click", function () {
            let strEmail = $("#txtLoginEmail").val();
            let strPassword = $("#txtLoginPassword").val();
            let strError = "";
            //tests if the email and password is valid according to our regex
            if (!regexEmail.test(strEmail)) {
                strError +=
                    '<p>Invalid Email (must have a "@", ".", and be a valid length)</p>';
            }

            if (!regexPassword.test(strPassword)) {
                strError +=
                    "<p>Invalid Password (Must have 8+ characters with 1 digit, 1 upper case and 1 lower case character)</p>";
            }

            if (strError) {
                Swal.fire({
                    title: "Oops!",
                    html: strError,
                    icon: "error",
                });
            }
            else {
                $.getJSON( //we get the password for the user listed and if the password is the same as the string, then we make a post to generate a session
                    "https://simplecoop.swollenhippo.com/users.php",
                    { Email: strEmail },
                    function (user) {
                        if (user.Password == strPassword) {
                            $.post(
                                "https://simplecoop.swollenhippo.com/sessions.php",
                                { Email: strEmail, Password: strPassword },
                                function (session) {
                                    if (session) {
                                        session = JSON.parse(session);
                                        sessionStorage.setItem("SessionID", session.SessionID);
                                        Swal.fire({
                                            icon: "success",
                                            text: "Created a session!",
                                            title: "Success"
                                        })
                                        $('#txtUserAccount').text(strEmail)
                                        $("#divLogin").slideToggle(function () {
                                            $("#divDashboard").slideToggle();
                                        })
                                    } else {
                                        Swal.fire({
                                            icon: "error",
                                            text: "No session!",
                                            title: "Error",
                                        });
                                    }
                                }
                            );
                        } else {
                            Swal.fire({
                                icon: "error",
                                text: "Invalid password!",
                                title: "Error",
                            });
                        }
                    }
                );
            }
        });

        // This is the function that validates all input on the Registration Card using length and regular expressions.
        $("#btnRegister").on("click", function () {
            let strError = "";
            let userExist = false;

            let strFirstName = $("#txtFirstName").val();
            let strLastName = $("#txtLastName").val();
            let strStAdd1 = $("#txtStreetAddress1").val();
            let strStAdd2 = $("#txtStreetAddress2").val();
            let strCity = $("#txtCity").val();
            let strState = $("#txtState").val();
            let strZip = $("#txtZipCode").val();
            let strEmail = $("#txtEmail").val();
            let strPassword = $("#txtPassword").val();
            let strCoopID = $("#txtCoopRegisterID").val();

            if (strFirstName.length < 1) { //all validation
                strError += "<p>Invalid First Name (cannot be blank)</p>";
            }
            if (strLastName.length < 1) {
                strError += "<p>Invalid Last Name (cannot be blank)</p>";
            }
            if (strStAdd1.length < 2) {
                strError += "<p>Invalid Address (must be at least 2 characters)</p>";
            }
            if (strCity.length < 2) {
                strError += "<p>Invalid City (must be at least 2 characters)</p>";
            }
            if (strState.length < 2) {
                strError += "<p>Invalid State (must be at least 2 characters)</p>";
            }
            if (strZip.length != 5) {
                strError += "<p>Invalid Zip Code (must be 5 characters)</p>";
            }
            if (!regexEmail.test(strEmail)) {
                strError +=
                    '<p>Invalid Email (must have a "@", ".", and be a valid length)</p>';
            }
            if (!regexPassword.test(strPassword)) {
                strError +=
                    "<p>Invalid Password (Must have 8+ characters with 1 digit, 1 upper case and 1 lower case character)</p>";
            }
            if (strCoopID != "QEJ73JMH") {
                strError += "<p>Invalid Coop ID (Must be 8 digits)</p>";
            }

            if (strError) {
                Swal.fire({
                    title: "Oops!",
                    html: strError,
                    icon: "error",
                });
            } else {
                $.getJSON( // calls a get to check if the user exisits if not sends a post to make one and a post with the address
                    "https://simplecoop.swollenhippo.com/users.php",
                    { Email: strEmail },
                    function (user) {
                        if (user != null) {
                            Swal.fire({
                                title: "Oops!",
                                text: "User with this email already exists!",
                                icon: "error",
                            });
                            userExist = true;
                        } else {
                            $.post(
                                "https://simplecoop.swollenhippo.com/useraddress.php",
                                {
                                    Email: strEmail,
                                    Street1: strStAdd1,
                                    Street2: strStAdd2,
                                    City: strCity,
                                    State: strState,
                                    ZIP: strZip,
                                },
                                function (result) {
                                    console.log(result);
                                }
                            );
                            $.post(
                                "https://simplecoop.swollenhippo.com/users.php",
                                {
                                    Email: strEmail,
                                    Password: strPassword,
                                    FirstName: strFirstName,
                                    LastName: strLastName,
                                    CoopID: strCoopID,
                                },
                                function (result) {
                                    console.log(result);
                                }
                            );

                            // clears all input on successful registration.
                            $("#txtFirstName").val("");
                            $("#txtLastName").val("");
                            $("#txtStreetAddress1").val("");
                            $("#txtStreetAddress2").val("");
                            $("#txtCity").val("");
                            $("#txtState").val("");
                            $("#txtZipCode").val("");
                            $("#txtEmail").val("");
                            $("#txtPassword").val("");
                            $("#txtCoopRegisterID").val("");

                            Swal.fire({
                                title: "Yippee!",
                                icon: "success",
                                text: "Account created!",
                            });

                            $("#divRegister2").slideUp(function () {
                                $("#divLogin").slideDown();
                            });
                        }
                    }
                );
            }
        });
    </script>
</body>
</html>